<section class="sec-banner">
    <div class="bnr-img">
        <img src="{{baseUrl}}/assets/images/properties2/banner2.png" class="w-100" alt="residential construction companies in bangalore" title="residential construction companies in bangalore">

        <div class="bg-bnr-layer">

        </div>

        <div class="baner-cont-abs1 d-lg-block d-none">
            <h1>
                EXPLORE PROPERTIES
            </h1>
        </div>

    </div>
</section>

<section class="sec py-lg-5 text-center">
    <div class="container" id="wholeCont">
        <h2 class="mn-hed py-4">PROJECTS DETAILS</h2>

        <!-- Section to display project details on click -->
        <div id="projectList1" class="row d-flex justify-content-around pt-lg-4">
            <!-- Loading placeholder -->
            <div class="col-12 text-center" id="loading-placeholder-details">
                <p>Click on a project below to view details...</p>
            </div>
        </div>
    </div>
</section>

<section class="sec py-lg-5 text-center">
    <div class="container">
        <h2 class="mn-hed py-4">ONGOING PROJECTS</h2>

        <!-- Container to hold dynamically rendered project cards -->
        <div id="projectList" class="row d-flex justify-content-around pt-lg-4">
            <!-- Loading placeholder -->
            <div class="col-12 text-center" id="loading-placeholder">
                <p>Loading projects...</p>
            </div>
        </div>

    </div>
</section>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAEpyMUKI8eH2xU7_3Ve3whYWs7dXWOrwI",
        authDomain: "atha-eb597.firebaseapp.com",
        databaseURL: "https://atha-eb597-default-rtdb.firebaseio.com",
        projectId: "atha-eb597",
        storageBucket: "atha-eb597.appspot.com",
        messagingSenderId: "793772614946",
        appId: "1:793772614946:web:45fb6b530052fbdc44b17b",
        measurementId: "G-NR4CK21TCC"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Function to render a single project item
    function renderProjectItem(project) {
        const projectList = document.getElementById("projectList");

        // Create a new div element for the project card
        const projectCard = document.createElement("div");
        projectCard.classList.add("col-lg-5");
        projectCard.classList.add("text-center");
        projectCard.classList.add("pb-5");

        // Add the HTML structure for the project card
        projectCard.innerHTML = `
            <a href="#wholeCont" style="color:black; text-decoration:none" >
                <div class="img-posrel">
                    <img src="${project.img_url}" class="w-100" alt="Project Image" loading="lazy" onerror="this.style.display='none'">
                </div>
                ${project.title ? `<p class="proj-nm1 pt-4">${project.title}</p>` : ''}
                ${project.locations ? `<p class="proj-inCont">${project.locations}</p>` : ''}
                ${project.feets ? `<p class="proj-inCont">${project.feets}</p>` : ''}
                <p class="proj-inCont"><b>Land Parcel : ${project.land1 || 'N/A'}</b></p>
            </a>
        `;

        // Add an onclick event to the project card
        projectCard.onclick = () => {
            storeProjectData(project); // Store project data in localStorage
            renderSelectedProject(project); // Render the selected project
        };

        // Append the project card to the project list container
        projectList.appendChild(projectCard);
    }

    // Function to render all projects
    function renderAllProjects(projects) {
        const projectList = document.getElementById("projectList");
        projectList.innerHTML = ""; // Clear any existing content
        
        // Hide loading placeholder
        const loadingPlaceholder = document.getElementById("loading-placeholder");
        if (loadingPlaceholder) {
            loadingPlaceholder.style.display = 'none';
        }
        
        if (projects.length === 0) {
            projectList.innerHTML = '<div class="col-12 text-center"><p>No projects available at the moment.</p></div>';
            return;
        }
        
        projects.forEach((project) => {
            renderProjectItem(project);
        });
    }

    // Function to fetch projects in real-time from Firestore
    async function getProjectsRealTime() {
        try {
            const dbRef = collection(db, "Projects");

            onSnapshot(dbRef, (querySnapshot) => {
                const projects = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (data && data.img_url) {
                        projects.push(data);
                    }
                });
                console.log(`Loaded ${projects.length} projects from Firebase`);
                renderAllProjects(projects);
            }, (error) => {
                console.error("Error fetching projects:", error);
                const projectList = document.getElementById("projectList");
                projectList.innerHTML = '<div class="col-12 text-center"><p>Error loading projects. Please try again later.</p></div>';
            });
        } catch (error) {
            console.error("Error initializing Firebase:", error);
            const projectList = document.getElementById("projectList");
            projectList.innerHTML = '<div class="col-12 text-center"><p>Error connecting to project service. Please try again later.</p></div>';
        }
    }

    // Function to store project data in localStorage
    function storeProjectData(project) {
        localStorage.setItem("selectedProject", JSON.stringify(project));
    }

    // Function to render selected project details
    function renderSelectedProject(project) {
        const projectList1 = document.getElementById("projectList1");

        // Clear any existing content
        projectList1.innerHTML = "";

        // Create the structure for the selected project
        const projectDetails = document.createElement("div");
        projectDetails.classList.add("col-12", "text-center", "pb-lg-5");

        projectDetails.innerHTML = `
            <img src="${project.img_url}" class="pro-det" alt="">

            ${project.title ? `<p class="prop-subhed pt-4 pb-2 mb-0">${project.title}</p>` : ''}

            ${project.locations ? `<p class="proj-inCont fs-6 fw-bold">${project.locations}</p>` : ''}

            ${project.feets ? `<p class="proj-inCont">${project.feets}</p>` : ''}
            <p class="proj-inCont mb-5"><b>Land Parcel : ${project.land1 || 'N/A'}</b></p>

            <section class="sec in-cont">
                <div class="container py-lg-5">
                    <div class="row d-flex align-items-center py-lg-5">
                        <div class="col-lg-8 pe-lg-5">
                            <p class="cm-fnt">
                                ${project.des || 'Project description not available.'}
                            </p>
                        </div>
                        <div class="col-lg-4 ps-lg-5 ps-4 text-start ov-content pt-lg-0 pt-5">
                            <div class="ovr-viw pb-3">
                                <div class="w-25">
                                    <img src="{{baseUrl}}/assets/images/properties2/bed.png" class="ov-img" alt="">
                                </div>
                                <div class="w-75">
                                    <p class="cont22">
                                        4 <br>
                                        BEDS
                                    </p>
                                </div>
                            </div>

                            <div class="ovr-viw pb-3">
                                <div class="w-25">
                                    <img src="{{baseUrl}}/assets/images/properties2/bath.png" class="ov-img" alt="">
                                </div>
                                <div class="w-75">
                                    <p class="cont22">
                                        5 <br>
                                        BATHS
                                    </p>
                                </div>
                            </div>

                            <div class="ovr-viw pb-3">
                                <div class="w-25">
                                    <img src="{{baseUrl}}/assets/images/properties2/area.png" class="ov-img" alt="">
                                </div>
                                <div class="w-75">
                                    <p class="cont22">
                                        ${project.land2 || '1326 to 1769 Sq.Ft.'}
                                        <br>
                                        LIVING AREA
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        `;

        // Append the selected project details
        projectList1.appendChild(projectDetails);
        
        // Scroll to top of details section
        document.getElementById("wholeCont").scrollIntoView({ behavior: 'smooth' });
    }

    // Function to load selected project details on page load
    function loadSelectedProjectOnPageLoad() {
        const storedProject = localStorage.getItem("selectedProject");
        if (storedProject) {
            const project = JSON.parse(storedProject);
            renderSelectedProject(project);
        }
    }

    // Event Listener: Load stored project on page load
    document.addEventListener("DOMContentLoaded", loadSelectedProjectOnPageLoad);

    // Fetch projects on page load
    getProjectsRealTime();
</script>

<style>
    .img-posrel {
        position: relative;
    }

    .pro-det {
        width: 100%;
    }

    .proj-nm1,
    .proj-inCont,
    .proj-inPric {
        margin: 5px 0;
    }
    
    .proj-nm1 {
        font-weight: bold;
        font-size: 1.2em;
    }
    
    .ovr-viw {
        display: flex;
        align-items: center;
    }
    
    .ov-img {
        width: 40px;
        height: 40px;
    }
    
    .cont22 {
        margin: 0;
        font-weight: 500;
    }
</style>